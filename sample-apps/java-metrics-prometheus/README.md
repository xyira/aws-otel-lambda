# Prometheus Metrics Sample App

This application sends a simple counter metric generated by the  OpenTelemetry Java Metrics SDK to Amazon Managed Service for Prometheus. You can find
deployment scripts using Terraform that are configured to deploy this sample app to AWS Lambda and
API Gateway while publishing and using the OpenTelemetry layers.

The Java Agent and Wrapper are not needed for this sample application, just a Collector Lambda layer. 

## Requirements

- Java for building this repository
- [Terraform](https://www.terraform.io/downloads.html)
- AWS credentials, either using environment variables or via the CLI and `aws configure`

First, navigate to [SampleMetricsApp](./SampleMetricsApp/) (or if you are in downstream aws-otel-lambda, navigate to upstream opentelemetry-lambda [SampleMetricsApp](../../opentelemetry-lambda/java/sample-apps/metrics-prometheus/SampleMetricsApp)).

```
./gradlew build
```

Then, navigate to [java-metrics-prometheus](./../java-metrics-prometheus/) and deploy with Terraform.

```
terraform init
terraform apply
```

After deployment, a URL which can be used to invoke the function via API Gateway will be displayed. 
Confirm that metrics are logged in the CloudWatch logs for the function on the AWS Console and metrics show up in AMP (and optionally visualized using Amazon Managed Service for Grafana).
